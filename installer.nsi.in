; Player by HEIMLICH Installer Script
; Professional video player for media analysis and frame-by-frame inspection

;--------------------------------
; General

  ; ì¸ìŠ¤í†¨ëŸ¬ ì •ë³´ - ìœ ë‹ˆì½”ë“œ ë¬¸ì œ í•´ê²°ì„ ìœ„í•´ ê°„ë‹¨í•˜ê²Œ ì„¤ì •
  !define APP_NAME "Player by HEIMLICH"
  !define APP_NAME_DISPLAY "Player by HEIMLICH"
  !define APP_VERSION "@PROJECT_VERSION@"
  !define APP_PUBLISHER "HEIMLICH"
  !define APP_URL "https://github.com/heimlich/player-by-heimlich"
  !define APP_DESCRIPTION "Player by HEIMLICH"
  
  ; ì‹¤í–‰ íŒŒì¼ ì´ë¦„ - ì‹¤ì œ ë¹Œë“œëœ ì´ë¦„ê³¼ ì¼ì¹˜
  !define APP_EXE "Player-by-HEIMLICH.exe"
  
  ; ê³ ê¸‰ UI ì‚¬ìš©
  !include "MUI2.nsh"
  !include "FileFunc.nsh"
  
  ; ì¸ìŠ¤í†¨ëŸ¬ ê¸°ë³¸ ì„¤ì •
  Name "${APP_NAME_DISPLAY}"
  OutFile "${APP_NAME}-Setup-v${APP_VERSION}.exe"
  Unicode True
  
  ; ê¸°ë³¸ ì„¤ì¹˜ ê²½ë¡œ
  InstallDir "$PROGRAMFILES64\${APP_NAME}"
  InstallDirRegKey HKLM "Software\${APP_PUBLISHER}\${APP_NAME}" "InstallDir"
  
  ; ê´€ë¦¬ì ê¶Œí•œ ìš”êµ¬
  RequestExecutionLevel admin
  
  ; ì••ì¶• ì„¤ì •
  SetCompressor /SOLID lzma
  SetCompressorDictSize 64
  
  ; ë²„ì „ ì •ë³´
  VIProductVersion "${APP_VERSION}.0"
  VIAddVersionKey "ProductName" "${APP_NAME}"
  VIAddVersionKey "ProductVersion" "${APP_VERSION}"
  VIAddVersionKey "CompanyName" "${APP_PUBLISHER}"
  VIAddVersionKey "FileDescription" "${APP_DESCRIPTION}"
  VIAddVersionKey "FileVersion" "${APP_VERSION}"
  VIAddVersionKey "LegalCopyright" "Â© 2025 ${APP_PUBLISHER}"

;--------------------------------
; Interface Settings

  ; MUI ì„¤ì •
  !define MUI_ABORTWARNING
  
  ; ì»¤ìŠ¤í…€ ì•„ì´ì½˜ ì‚¬ìš© - ìƒëŒ€ ê²½ë¡œ
  !define MUI_ICON "assets\\Images\\icon_win.ico"
  !define MUI_UNICON "assets\\Images\\icon_win.ico"
  
  ; ì¸ìŠ¤í†¨ëŸ¬ ìì²´ ì•„ì´ì½˜ë„ ì„¤ì • (exe íŒŒì¼ ì•„ì´ì½˜)
  Icon "assets\\Images\\icon_win.ico"
  UninstallIcon "assets\\Images\\icon_win.ico"
  
  ; ëª¨ë˜ UI ì„¤ì •
  !define MUI_HEADERIMAGE
  !define MUI_HEADERIMAGE_RIGHT
  !define MUI_COMPONENTSPAGE_SMALLDESC
  
  ; ë” ë‹¤í¬í•œ ìƒ‰ìƒ ì„¤ì • (ì œí•œì ì´ì§€ë§Œ ì ìš©)
  !define MUI_TEXTCOLOR "F0F0F0"
  !define MUI_BGCOLOR "2D2D30"
  
  ; ì„¤ì¹˜ í˜ì´ì§€ ìƒ‰ìƒ (ë‹¤í¬ ì½˜ì†” ìŠ¤íƒ€ì¼)
  !define MUI_INSTFILESPAGE_COLORS "F0F0F0 1E1E1E"
  
  ; ë¼ì´ì„¼ìŠ¤ í˜ì´ì§€ ë°°ê²½ìƒ‰ (ë‹¤í¬)
  !define MUI_LICENSEPAGE_BGCOLOR "1E1E1E"
  
  ; ë””ë ‰í† ë¦¬ ì„ íƒ í˜ì´ì§€ ë°°ê²½ìƒ‰
  !define MUI_DIRECTORYPAGE_BGCOLOR "2D2D30"
  
  ; ì‹œì‘ ë©”ë‰´ í´ë” ë°°ê²½ìƒ‰
  !define MUI_STARTMENUPAGE_BGCOLOR "2D2D30"
  
  ; ì»¤ìŠ¤í…€ ë¸Œëœë”© í…ìŠ¤íŠ¸ (ë” ìŠ¤íƒ€ì¼ë¦¬ì‹œí•˜ê²Œ)
  !define MUI_BRANDINGTEXT "Player by HEIMLICHÂ® v${APP_VERSION} | Professional Video Technology"
  
  ; í™˜ì˜ í˜ì´ì§€ ì„¤ì •
  !define MUI_WELCOMEPAGE_TITLE "Welcome to Player by HEIMLICHÂ® Setup"
  !define MUI_WELCOMEPAGE_TEXT "This setup wizard will install Player by HEIMLICHÂ® - Professional Video Player$\r$\n$\r$\nâœ“ Hardware-accelerated video playback$\r$\nâœ“ Frame-by-frame analysis tools$\r$\nâœ“ Advanced media controls$\r$\nâœ“ Professional-grade performance$\r$\n$\r$\nClick Next to begin the installation."
  
  ; ì™„ë£Œ í˜ì´ì§€ ì„¤ì •
  !define MUI_FINISHPAGE_RUN "$INSTDIR\\${APP_EXE}"
  !define MUI_FINISHPAGE_RUN_TEXT "Launch Player by HEIMLICHÂ® now"
  !define MUI_FINISHPAGE_TITLE "Setup Complete"
  !define MUI_FINISHPAGE_TEXT "Player by HEIMLICHÂ® has been successfully installed.$\r$\n$\r$\nğŸ¯ Ready for professional video analysis$\r$\nğŸš€ Optimized for high-performance playback$\r$\nâš¡ Hardware acceleration enabled$\r$\n$\r$\nThank you for choosing Player by HEIMLICHÂ®!"
  
  ; ë°”íƒ•í™”ë©´ ë°”ë¡œê°€ê¸° ìƒì„± ì˜µì…˜
  !define MUI_FINISHPAGE_SHOWREADME ""
  !define MUI_FINISHPAGE_SHOWREADME_NOTCHECKED
  !define MUI_FINISHPAGE_SHOWREADME_TEXT "Create desktop shortcut"
  !define MUI_FINISHPAGE_SHOWREADME_FUNCTION CreateDesktopShortcut
  
  ; ì–¸ì¸ìŠ¤í†¨ ì„¤ì •
  !define MUI_UNWELCOMEPAGE_TITLE "Uninstall Player by HEIMLICHÂ®"
  !define MUI_UNWELCOMEPAGE_TEXT "This wizard will completely remove Player by HEIMLICHÂ® from your computer.$\r$\n$\r$\nâš ï¸ Please ensure Player by HEIMLICHÂ® is not currently running.$\r$\n$\r$\nClick Next to continue with the uninstallation."

;--------------------------------
; Pages

  ; ì„¤ì¹˜ í˜ì´ì§€ë“¤
  !insertmacro MUI_PAGE_WELCOME
  !insertmacro MUI_PAGE_LICENSE "LICENSE.txt"
  !insertmacro MUI_PAGE_COMPONENTS
  !insertmacro MUI_PAGE_DIRECTORY
  !insertmacro MUI_PAGE_INSTFILES
  !insertmacro MUI_PAGE_FINISH
  
  ; ì œê±° í˜ì´ì§€ë“¤
  !insertmacro MUI_UNPAGE_WELCOME
  !insertmacro MUI_UNPAGE_CONFIRM
  !insertmacro MUI_UNPAGE_INSTFILES
  !insertmacro MUI_UNPAGE_FINISH

;--------------------------------
; Languages

  !insertmacro MUI_LANGUAGE "English"
  !insertmacro MUI_LANGUAGE "Korean"

;--------------------------------
; License

LicenseData "LICENSE.txt"

;--------------------------------
; Installer Sections

Section "${APP_NAME} (required)" SecMain
  
  SectionIn RO
  
  ; íŒŒì¼ ì„¤ì¹˜ ì‹œì‘
  SetOutPath "$INSTDIR"
  
  ; ë©”ì¸ ì‹¤í–‰íŒŒì¼
  File "build\${APP_EXE}"
  
  ; Qt ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤
  File "build\*.dll"
  
  ; í´ë”ë“¤ ë³µì‚¬
  File /r "build\platforms"
  File /r "build\styles"
  File /r "build\imageformats"
  File /r "build\qml"
  File /r "build\translations"
  File /r "build\assets"
  
  ; ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ì„¤ì¹˜ ì •ë³´ ì €ì¥
  WriteRegStr HKLM "Software\${APP_PUBLISHER}\${APP_NAME}" "InstallDir" "$INSTDIR"
  WriteRegStr HKLM "Software\${APP_PUBLISHER}\${APP_NAME}" "Version" "${APP_VERSION}"
  
  ; í”„ë¡œê·¸ë¨ ì¶”ê°€/ì œê±°ì— ë“±ë¡
  WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${APP_NAME}" "DisplayName" "${APP_NAME}"
  WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${APP_NAME}" "DisplayVersion" "${APP_VERSION}"
  WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${APP_NAME}" "Publisher" "${APP_PUBLISHER}"
  WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${APP_NAME}" "URLInfoAbout" "${APP_URL}"
  WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${APP_NAME}" "DisplayIcon" "$INSTDIR\${APP_EXE}"
  WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${APP_NAME}" "UninstallString" "$INSTDIR\Uninstall.exe"
  WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${APP_NAME}" "QuietUninstallString" "$INSTDIR\Uninstall.exe /S"
  WriteRegDWORD HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${APP_NAME}" "NoModify" 1
  WriteRegDWORD HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${APP_NAME}" "NoRepair" 1
  
  ; ì„¤ì¹˜ í¬ê¸° ê³„ì‚°
  ${GetSize} "$INSTDIR" "/S=0K" $0 $1 $2
  IntFmt $0 "0x%08X" $0
  WriteRegDWORD HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${APP_NAME}" "EstimatedSize" "$0"
  
  ; ì–¸ì¸ìŠ¤í†¨ëŸ¬ ìƒì„±
  WriteUninstaller "$INSTDIR\Uninstall.exe"
  
SectionEnd

; ì‹œì‘ ë©”ë‰´ ë°”ë¡œê°€ê¸°
Section "Start Menu Shortcuts" SecStartMenu
  
  CreateDirectory "$SMPROGRAMS\${APP_NAME}"
  CreateShortcut "$SMPROGRAMS\${APP_NAME}\${APP_NAME}.lnk" "$INSTDIR\${APP_EXE}" "" "$INSTDIR\${APP_EXE}" 0
  CreateShortcut "$SMPROGRAMS\${APP_NAME}\Uninstall.lnk" "$INSTDIR\Uninstall.exe" "" "$INSTDIR\Uninstall.exe" 0
  
SectionEnd

; íŒŒì¼ ì—°ê²° (ì„ íƒì‚¬í•­)
Section "File Associations" SecFileAssoc
  
  ; ë¹„ë””ì˜¤ íŒŒì¼ ì—°ê²° ì˜ˆì‹œ (.mp4, .avi, .mkv ë“±)
  WriteRegStr HKCR ".mp4\OpenWithProgids" "${APP_NAME}.mp4" ""
  WriteRegStr HKCR ".avi\OpenWithProgids" "${APP_NAME}.avi" ""
  WriteRegStr HKCR ".mkv\OpenWithProgids" "${APP_NAME}.mkv" ""
  WriteRegStr HKCR ".mov\OpenWithProgids" "${APP_NAME}.mov" ""
  WriteRegStr HKCR ".wmv\OpenWithProgids" "${APP_NAME}.wmv" ""
  
  ; í”„ë¡œê·¸ë¨ ì •ë³´ ë“±ë¡
  WriteRegStr HKCR "${APP_NAME}.VideoFile" "" "${APP_NAME} Video File"
  WriteRegStr HKCR "${APP_NAME}.VideoFile\DefaultIcon" "" "$INSTDIR\${APP_EXE},0"
  WriteRegStr HKCR "${APP_NAME}.VideoFile\shell\open\command" "" '"$INSTDIR\${APP_EXE}" "%1"'
  
SectionEnd

;--------------------------------
; Descriptions

  ; ì„¹ì…˜ ì„¤ëª…
  LangString DESC_SecMain ${LANG_ENGLISH} "Core application files (required)"
  LangString DESC_SecMain ${LANG_KOREAN} "í•µì‹¬ ì• í”Œë¦¬ì¼€ì´ì…˜ íŒŒì¼ (í•„ìˆ˜)"
  
  LangString DESC_SecStartMenu ${LANG_ENGLISH} "Create shortcuts in Start Menu"
  LangString DESC_SecStartMenu ${LANG_KOREAN} "ì‹œì‘ ë©”ë‰´ì— ë°”ë¡œê°€ê¸° ìƒì„±"
  
  LangString DESC_SecFileAssoc ${LANG_ENGLISH} "Associate video files with ${APP_NAME}"
  LangString DESC_SecFileAssoc ${LANG_KOREAN} "ë¹„ë””ì˜¤ íŒŒì¼ì„ ${APP_NAME}ê³¼ ì—°ê²°"
  
  !insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN
    !insertmacro MUI_DESCRIPTION_TEXT ${SecMain} $(DESC_SecMain)
    !insertmacro MUI_DESCRIPTION_TEXT ${SecStartMenu} $(DESC_SecStartMenu)
    !insertmacro MUI_DESCRIPTION_TEXT ${SecFileAssoc} $(DESC_SecFileAssoc)
  !insertmacro MUI_FUNCTION_DESCRIPTION_END

;--------------------------------
; Functions

; ë°”íƒ•í™”ë©´ ë°”ë¡œê°€ê¸° ìƒì„± í•¨ìˆ˜
Function CreateDesktopShortcut
  CreateShortcut "$DESKTOP\${APP_NAME}.lnk" "$INSTDIR\${APP_EXE}" "" "$INSTDIR\${APP_EXE}" 0
FunctionEnd

;--------------------------------
; Uninstaller

Section "Uninstall"
  
  ; íŒŒì¼ë“¤ ì‚­ì œ
  Delete "$INSTDIR\${APP_EXE}"
  Delete "$INSTDIR\*.dll"
  Delete "$INSTDIR\Uninstall.exe"
  
  ; í´ë”ë“¤ ì‚­ì œ
  RMDir /r "$INSTDIR\platforms"
  RMDir /r "$INSTDIR\styles"
  RMDir /r "$INSTDIR\imageformats"
  RMDir /r "$INSTDIR\qml"
  RMDir /r "$INSTDIR\translations"
  RMDir /r "$INSTDIR\assets"
  
  ; ì„¤ì¹˜ í´ë” ì‚­ì œ
  RMDir "$INSTDIR"
  
  ; ì‹œì‘ ë©”ë‰´ ë°”ë¡œê°€ê¸° ì‚­ì œ
  Delete "$SMPROGRAMS\${APP_NAME}\${APP_NAME}.lnk"
  Delete "$SMPROGRAMS\${APP_NAME}\Uninstall.lnk"
  RMDir "$SMPROGRAMS\${APP_NAME}"
  
  ; ë°”íƒ•í™”ë©´ ë°”ë¡œê°€ê¸° ì‚­ì œ
  Delete "$DESKTOP\${APP_NAME}.lnk"
  
  ; ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì •ë¦¬
  DeleteRegKey HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${APP_NAME}"
  DeleteRegKey HKLM "Software\${APP_PUBLISHER}\${APP_NAME}"
  
  ; íŒŒì¼ ì—°ê²° ì œê±°
  DeleteRegKey HKCR "${APP_NAME}.VideoFile"
  DeleteRegValue HKCR ".mp4\OpenWithProgids" "${APP_NAME}.mp4"
  DeleteRegValue HKCR ".avi\OpenWithProgids" "${APP_NAME}.avi"
  DeleteRegValue HKCR ".mkv\OpenWithProgids" "${APP_NAME}.mkv"
  DeleteRegValue HKCR ".mov\OpenWithProgids" "${APP_NAME}.mov"
  DeleteRegValue HKCR ".wmv\OpenWithProgids" "${APP_NAME}.wmv"
  
SectionEnd 